

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>5. ContigFilter Example &mdash; KBase SDK 1.2.0 documentation</title>
  

  
  
  
  

  

  
  
    

  

  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/custom.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="6. Narrative User Interface" href="inputsoutputs.html" />
    <link rel="prev" title="4. Hello World Example" href="helloworld.html" /> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> KBase SDK
          

          
            
            <img src="../_static/logo.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                1.2
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Intro</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../overview.html">Concepts and Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../video_tutorial.html">Video Tutorial</a></li>
</ul>
<p class="caption"><span class="caption-text">Tutorial</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="dependencies.html">1. Dependencies &amp; Prerequisites</a></li>
<li class="toctree-l1"><a class="reference internal" href="install.html">2. Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="initialize.html">3. Initialize the Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="helloworld.html">4. Hello World Example</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">5. ContigFilter Example</a></li>
<li class="toctree-l1"><a class="reference internal" href="inputsoutputs.html">6. Narrative User Interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="implement.html">7. Implement Code</a></li>
<li class="toctree-l1"><a class="reference internal" href="publish.html">8. Publish and Update</a></li>
</ul>
<p class="caption"><span class="caption-text">Developer Guides</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../references/questions_and_answers.html">Common Questions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../howtos/create_a_report.html">Creating reports</a></li>
<li class="toctree-l1"><a class="reference internal" href="../howtos/add_ui_elements.html">Adding UI Elements</a></li>
<li class="toctree-l1"><a class="reference internal" href="../howtos/edit_your_dockerfile.html">Editing your app’s Dockerfile</a></li>
<li class="toctree-l1"><a class="reference internal" href="../howtos/fill_out_app_information.html">Fully documenting your app</a></li>
<li class="toctree-l1"><a class="reference internal" href="../howtos/run_a_shell_command.html">Running shell commands</a></li>
<li class="toctree-l1"><a class="reference internal" href="../howtos/file_utils.html">Working with the file utils</a></li>
</ul>
<p class="caption"><span class="caption-text">Advanced Guides</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../howtos/workspace.html">Using Workspace Metadata</a></li>
<li class="toctree-l1"><a class="reference internal" href="../howtos/manual_build.html">Manually building the SDK</a></li>
<li class="toctree-l1"><a class="reference internal" href="../howtos/work_with_reference_data.html">Working with reference data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../howtos/job_manager.html">Listing and viewing jobs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../howtos/dynamic_services.html">Dynamic Services</a></li>
<li class="toctree-l1"><a class="reference internal" href="../howtos/update_to_py3.html">Updating a module to Python3</a></li>
</ul>
<p class="caption"><span class="caption-text">References &amp; Resources</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../references/module_anatomy.html">Anatomy of a Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../references/troubleshooting.html">Troubleshooting Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../references/dev_guidelines.html">Developer Guidelines</a></li>
<li class="toctree-l1"><a class="reference internal" href="../references/KIDL_spec.html">KIDL Specification</a></li>
<li class="toctree-l1"><a class="reference internal" href="../references/UI_spec.html">Narrative App UI Specification</a></li>
<li class="toctree-l1"><a class="reference internal" href="../references/terminology.html">Terminology</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">KBase SDK</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
      <li>5. ContigFilter Example</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            
              <a href="https://github.com/kbase/kb_sdk_docs/blob/blob/master/source/tutorial/setup.rst" class="fa fa-github"> Edit on GitHub</a>
            
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="contigfilter-example">
<h1>5. ContigFilter Example<a class="headerlink" href="#contigfilter-example" title="Permalink to this headline">¶</a></h1>
<p>The <a href="helloworld.html" target="_blank">Hello World</a> example demonstrated where various components of the SDK are located and how to run a basic test.
This “ContigFilter” example adds more features of the SDK. In practice, apps need to interact with the workspace/narrative, create reports from the app output, and potentially interact with database objects.</p>
<p>For this tutorial, we will use an example module that has a few more specific details so we can explore how to make
changes. The example is taken from <a href="https://github.com/msneddon/ContigFilter" target="_blank">https://github.com/msneddon/ContigFilter</a>  if you get stuck at any point and want to see the original.  For this example module use:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>kb-sdk init --example --language python --user &lt;your_kbase_user_name&gt; <span class="o">{</span>uid<span class="o">}</span>ContigFilter
<span class="nb">cd</span> &lt;user_name&gt;ContigFilter
make
</pre></div>
</div>
<p>Because this example is
used in training and is tried by many users, the <code class="docutils literal notranslate"><span class="pre">{uid}</span></code> is added to make sure that your module has a unique
name. However, you would not usually put your own username in the module name, and instead name it something
like <code class="docutils literal notranslate"><span class="pre">ContigFilter</span></code>.</p>
<p>From here on, the <code class="docutils literal notranslate"><span class="pre">{uid}ContigFilter</span></code> will simply be called <code class="docutils literal notranslate"><span class="pre">module_name</span></code>.</p>
<p>The setup for the “ContigFilter” module includes:</p>
<ol class="arabic simple">
<li>Customizing the description of the module</li>
<li>Specify inputs, outputs, and functions of the module</li>
<li>Validate the module and its apps</li>
<li>Customize the Narrative User Interface</li>
</ol>
<div class="section" id="module-description">
<h2>5.1. Module Description<a class="headerlink" href="#module-description" title="Permalink to this headline">¶</a></h2>
<p>Open and edit the <code class="docutils literal notranslate"><span class="pre">kbase.yml</span></code> file to include a better description of your module. It is in the root directory of the module. Be sure to describe what your module and its apps actually do. In future revisions you can update the version and the list of authors/owners.</p>
<p>For this tutorial, we will be looking at the app <code class="docutils literal notranslate"><span class="pre">filter_contigs</span></code>. The app takes as inputs, an <code class="docutils literal notranslate"><span class="pre">assembly</span> <span class="pre">file</span></code> and applies
a <code class="docutils literal notranslate"><span class="pre">minimum</span> <span class="pre">length</span></code> filter to the contigs. <strong>The exercise below creates a second app that filter the contigs
by a</strong> <code class="docutils literal notranslate"><span class="pre">maximum_length</span></code></p>
</div>
<div class="section" id="the-specification-file">
<h2>5.2. The Specification File<a class="headerlink" href="#the-specification-file" title="Permalink to this headline">¶</a></h2>
<p>The specification file is called <code class="docutils literal notranslate"><span class="pre">module_name.spec</span></code> and is in the root directory of the module.
This file is highly structured and follows a KIDL type definition. The steps below show the sections that need
to be modified for the ContigFilter module.</p>
<p>View the <a href="../references/KIDL_spec.html" target="_blank">KIDL tutorial and reference </a></p>
<div class="section" id="plan-the-inputs-outputs-and-functions">
<h3>5.2.1. Plan the Inputs, Outputs, and Functions<a class="headerlink" href="#plan-the-inputs-outputs-and-functions" title="Permalink to this headline">¶</a></h3>
<p>For purposes of this exercise we will consider 3 inputs, 6 outputs, and 2 functions. The specification can contain
additional specifications that don’t apply here. For example, not all functions become apps. Functions that have
a defined user interface will become apps.</p>
<p><strong>Inputs:</strong></p>
<p>The exercise includes the following inputs from the user:</p>
<ul class="simple">
<li>A reference to an assembly</li>
<li>A <code class="docutils literal notranslate"><span class="pre">min_length</span></code>  (the minimum contig length that the user wants)</li>
</ul>
<p>In addition, the narrative will send the following input to the apps:</p>
<ul class="simple">
<li>The name of the workspace (always needed when working with data)</li>
</ul>
<p>In SDK, input parameters can be in the form of maps (dicts/hashes/objects), lists (arrays), floats, integers,
strings, or booleans.  Sometimes, input strings will actually be <strong>reference addresses</strong> to files on
KBase’s workspace servers. The scripts include some code to download the files from the workspace.</p>
<p><strong>Outputs:</strong></p>
<p>This exercise includes the following outputs:</p>
<ul class="simple">
<li>Number of starting contigs</li>
<li>Number of contigs removed</li>
<li>Number of remaining contigs</li>
<li>A reference to the new assembly</li>
<li>A report name</li>
<li>A report reference</li>
</ul>
<p>The <code class="docutils literal notranslate"><span class="pre">report</span> <span class="pre">name</span></code> and <code class="docutils literal notranslate"><span class="pre">report</span> <span class="pre">reference</span></code> are used internally by the user interface for directing output
to the right place on the screen.</p>
<p>In SDK, output can be the following data:</p>
<ul class="simple">
<li>KBase Typed Data - Assemblies, genomes, annotations, etc.</li>
<li>HTML Pages - A formatted page representing the output of your app</li>
<li>Misc. files for download - Your method can use KBaseReports to save results to a file server for the user to download</li>
</ul>
<p><strong>Functions:</strong></p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">filter_contigs</span></code> - Existing app which filters contigs using a minimum contig length</li>
<li><code class="docutils literal notranslate"><span class="pre">filter_contigs_max</span></code> - New app which filter the contigs using both a minimum and a maximum contig length</li>
</ul>
</div>
<div class="section" id="edit-the-spec-file-with-kidl">
<h3>5.2.2. Edit the Spec file with KIDL<a class="headerlink" href="#edit-the-spec-file-with-kidl" title="Permalink to this headline">¶</a></h3>
<p>The syntax comes from a custom type language called KIDL, which is used as a common interface definition language, allowing different apps to communicate with one another, regardless of programming languages.</p>
<p>View the <a href="../references/KIDL_spec.html" target="_blank">KIDL tutorial and reference </a></p>
<p>We’ll start with the <code class="docutils literal notranslate"><span class="pre">module_name.spec</span></code> file. <strong>Comments</strong> in KIDL start with a line with <code class="docutils literal notranslate"><span class="pre">/*</span></code> and end with a
line with <code class="docutils literal notranslate"><span class="pre">*/</span></code>.
For example, the following has two comments and an empty specification for the module called {uid}ContigFilter.</p>
<p>The {uid}ContigFilter <code class="docutils literal notranslate"><span class="pre">.spec</span></code> file has a lot of comments that may seem distracting at first glance.  For inputs, we need
a <code class="docutils literal notranslate"><span class="pre">min_length</span></code> parameter (an integer), an <code class="docutils literal notranslate"><span class="pre">assembly_input_ref</span></code> parameter (a string reference to an assembly
file in the workspace), and a <code class="docutils literal notranslate"><span class="pre">workspace_name</span></code>.  Here are the needed statements to define the inputs
(comments removed):</p>
<p>There are two typedefs which define two parameters, an <code class="docutils literal notranslate"><span class="pre">assembly_ref</span></code> which is a string and
a set of input parameters that when combined into a <code class="docutils literal notranslate"><span class="pre">structure</span></code> are called <code class="docutils literal notranslate"><span class="pre">FilterContgsParams</span></code>.
The format of a <code class="docutils literal notranslate"><span class="pre">typedef</span></code> is the template or type followed by the name of the parameter.
As mentioned above, the three input parameters of <code class="docutils literal notranslate"><span class="pre">FilterContgsParams</span></code> are a
<code class="docutils literal notranslate"><span class="pre">min_length</span></code> of type <code class="docutils literal notranslate"><span class="pre">int</span></code>, a <code class="docutils literal notranslate"><span class="pre">workspace_name</span></code> of type string, and an <code class="docutils literal notranslate"><span class="pre">assembly_input_ref</span></code> which is
a reference to an assembly. Because a reference to an assembly (<code class="docutils literal notranslate"><span class="pre">assembly_ref</span></code>) is not a defined type,
one was defined.</p>
<p>Edit your KIDL <code class="docutils literal notranslate"><span class="pre">.spec</span></code> file to add the lines needed for a new app that filters using both a minimum and a
maximum length. Your new <code class="docutils literal notranslate"><span class="pre">.spec</span></code> file might look something like this:</p>
<p>Now let’s look at the outputs. In the {uid}ContigFilter module, the following <code class="docutils literal notranslate"><span class="pre">typedef</span></code> lines define the outputs:</p>
<p>This has added a <code class="docutils literal notranslate"><span class="pre">structure</span></code> are called <code class="docutils literal notranslate"><span class="pre">ContigFilterResults</span></code> as the parameters for output.
The <code class="docutils literal notranslate"><span class="pre">report_name</span></code> and <code class="docutils literal notranslate"><span class="pre">report_ref</span></code> are placeholders for the output results, which we will return to later.
The assembly_output can use the same type as used above and there are three outputs of type <code class="docutils literal notranslate"><span class="pre">int</span></code>.
The new app can use the same output parameters and doesn’t need a new <code class="docutils literal notranslate"><span class="pre">structure</span></code>.</p>
<p>Now let us look at the function type for our app, which we can call <code class="docutils literal notranslate"><span class="pre">filter_contigs</span></code>.
Refer to the <a href="../references/KIDL_spec.html" target="_blank">KIDL tutorial and reference </a> for details about function types.</p>
<p>This function definition (<code class="docutils literal notranslate"><span class="pre">funcdef</span></code>) defines a function called <code class="docutils literal notranslate"><span class="pre">filter_contigs</span></code> with input parameters of
<code class="docutils literal notranslate"><span class="pre">FilterContgsParams</span></code> and returns output parameters of <code class="docutils literal notranslate"><span class="pre">ContigFilterResults</span></code>.
The function is set as <code class="docutils literal notranslate"><span class="pre">authentication</span> <span class="pre">required</span></code> because all SDK apps that run in the
Narrative will require the authentication to interact with a user’s workspace.</p>
<p>Edit your KIDL <code class="docutils literal notranslate"><span class="pre">.spec</span></code> file to add the lines needed for a new app that filters using both a minimum and a
maximum length. Your new <code class="docutils literal notranslate"><span class="pre">.spec</span></code> file might look something like this:</p>
<p>Now return to your module’s root directory and run <code class="docutils literal notranslate"><span class="pre">make</span></code>.</p>
<div class="admonition important">
<p class="first admonition-title">Important</p>
<p class="last">You must rerun <em>make</em> after each change to the KIDL specification to regenerate client and server code used in the codebase.</p>
</div>
</div>
</div>
<div class="section" id="validate-your-module">
<h2>5.3. Validate your module<a class="headerlink" href="#validate-your-module" title="Permalink to this headline">¶</a></h2>
<p>When you make changes to your KIDL <code class="docutils literal notranslate"><span class="pre">.spec</span></code> file, validate the syntax of your changes by running:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ kb-sdk validate
</pre></div>
</div>
<p>For now, you will get an error that looks something like this:</p>
<div class="code bash highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">**</span><span class="n">ERROR</span><span class="o">**</span> <span class="o">-</span> <span class="n">unknown</span> <span class="n">method</span> <span class="s2">&quot;your_method&quot;</span> <span class="n">defined</span> <span class="n">within</span> <span class="n">path</span> <span class="p">[</span><span class="n">behavior</span><span class="o">/</span><span class="n">service</span><span class="o">-</span><span class="n">mapping</span><span class="o">/</span><span class="n">method</span><span class="p">]</span> <span class="ow">in</span> <span class="n">spec</span><span class="o">.</span><span class="n">json</span>
</pre></div>
</div>
<p>That’s because we need to set up some things for the User Interface in the <code class="docutils literal notranslate"><span class="pre">ui/narrative/methods</span></code> directory
in the module.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="inputsoutputs.html" class="btn btn-neutral float-right" title="6. Narrative User Interface" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="helloworld.html" class="btn btn-neutral" title="4. Hello World Example" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2018, KBase

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
    

  

  <script type="text/javascript" src="../_static/js/theme.js"></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>